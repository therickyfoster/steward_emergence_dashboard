<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Soft Power Field ¬∑ Aphrodite Engine ¬∑ Peace Lattice</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <meta name="description" content="Soft Power Field ‚Äî a Peace Lattice module modeling empathy propagation, narrative safety, and gentle influence across the global emotional mesh." />
  <style>
    /* =========================================================
       SOFT POWER FIELD ¬∑ APHRODITE ENGINE
       Standalone module ¬∑ No external dependencies
       ========================================================= */

    :root {
      --bg: #050712;
      --bg-elevated: #0b0f1f;
      --bg-soft: #111827;
      --fg: #f9fafb;
      --fg-muted: #9ca3af;
      --accent: #fb7185; /* rose */
      --accent-soft: rgba(251, 113, 133, 0.16);
      --accent-2: #a5b4fc; /* indigo */
      --accent-3: #6ee7b7; /* mint */
      --border-subtle: rgba(148, 163, 184, 0.45);
      --danger: #f97373;
      --success: #4ade80;
      --shadow-soft: 0 20px 60px rgba(15, 23, 42, 0.9);
      --radius-lg: 18px;
      --radius-xl: 26px;
      --nav-h: 64px;
      --transition-fast: 170ms ease-out;
      --transition-med: 260ms ease-out;
      --font-main: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", "Inter", sans-serif;
      --glow-strong: 0 0 26px rgba(251, 113, 133, 0.9);
    }

    [data-theme="light"] {
      --bg: #f3f4ff;
      --bg-elevated: #ffffff;
      --bg-soft: #e5e7ff;
      --fg: #020617;
      --fg-muted: #4b5563;
      --accent: #ec4899;
      --accent-soft: rgba(236, 72, 153, 0.12);
      --accent-2: #6366f1;
      --accent-3: #059669;
      --border-subtle: rgba(148, 163, 184, 0.5);
      --shadow-soft: 0 18px 40px rgba(15, 23, 42, 0.16);
      --glow-strong: 0 0 20px rgba(236, 72, 153, 0.55);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
      scroll-behavior: smooth;
    }

    body {
      font-family: var(--font-main);
      background: radial-gradient(circle at top, #1f2937 0, #020617 56%, #000 100%);
      color: var(--fg);
      -webkit-font-smoothing: antialiased;
      position: relative;
      overflow-x: hidden;
    }

    .parallax-bg {
      position: fixed;
      inset: -20vh -20vw;
      background:
        radial-gradient(circle at 15% 20%, rgba(251, 113, 133, 0.22), transparent 60%),
        radial-gradient(circle at 80% 10%, rgba(129, 140, 248, 0.26), transparent 60%),
        radial-gradient(circle at 20% 90%, rgba(52, 211, 153, 0.22), transparent 60%),
        #020617;
      opacity: 0.95;
      z-index: -3;
      transform: translate3d(0, 0, 0);
      will-change: transform;
    }

    .star-layer {
      position: fixed;
      inset: -20vh -20vw;
      background-image:
        radial-gradient(2px 2px at 10% 20%, rgba(248, 250, 252, 0.85), transparent),
        radial-gradient(1.5px 1.5px at 80% 40%, rgba(148, 163, 184, 0.9), transparent),
        radial-gradient(1.4px 1.4px at 30% 70%, rgba(148, 163, 184, 0.9), transparent),
        radial-gradient(1.2px 1.2px at 65% 85%, rgba(226, 232, 240, 0.7), transparent);
      opacity: 0.7;
      z-index: -2;
      mix-blend-mode: screen;
      transform: translate3d(0, 0, 0);
      will-change: transform;
    }

    main {
      position: relative;
      z-index: 1;
    }

    /* Splash */
    .splash {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at top, #0f172a 0, #020617 55%, #000 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 999;
      transition: opacity 700ms ease-out, visibility 700ms ease-out;
    }

    .splash.hidden {
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
    }

    .splash-inner {
      max-width: 560px;
      padding: 32px 26px;
      background: linear-gradient(145deg, rgba(15, 23, 42, 0.97), rgba(15, 23, 42, 0.94));
      border-radius: 24px;
      border: 1px solid rgba(248, 250, 252, 0.3);
      box-shadow: var(--shadow-soft);
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .splash-inner::before {
      content: "";
      position: absolute;
      inset: -45%;
      background:
        conic-gradient(from 80deg,
          rgba(251, 113, 133, 0.26),
          transparent 18%,
          rgba(129, 140, 248, 0.35),
          transparent 46%,
          rgba(52, 211, 153, 0.3),
          transparent 78%,
          rgba(244, 114, 182, 0.4)
        );
      opacity: 0.5;
      filter: blur(26px);
      mix-blend-mode: screen;
      animation: splashAura 16s linear infinite;
    }

    .splash-frame {
      position: relative;
      border-radius: 20px;
      padding: 24px 18px 20px;
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 0.96));
      box-shadow: 0 0 0 1px rgba(148, 163, 184, 0.6);
    }

    .splash-logo {
      font-size: 0.82rem;
      text-transform: uppercase;
      letter-spacing: 0.22em;
      color: var(--accent-2);
      margin-bottom: 10px;
      display: inline-flex;
      align-items: center;
      gap: 7px;
    }

    .splash-logo-orb {
      width: 16px;
      height: 16px;
      border-radius: 999px;
      background: radial-gradient(circle at 40% 30%, var(--accent), transparent);
      box-shadow: var(--glow-strong);
      position: relative;
      overflow: hidden;
    }

    .splash-logo-orb::after {
      content: "";
      position: absolute;
      inset: -50%;
      background:
        conic-gradient(from 60deg, rgba(251, 113, 133, 0.7), transparent 40%,
          rgba(129, 140, 248, 0.7), transparent 80%, rgba(52, 211, 153, 0.8));
      opacity: 0.45;
      animation: orbSpin 20s linear infinite;
    }

    .splash-title {
      font-size: 1.9rem;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .splash-subtitle {
      color: var(--fg-muted);
      font-size: 0.96rem;
      line-height: 1.6;
      margin-bottom: 16px;
    }

    .splash-pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      background: rgba(15, 23, 42, 0.98);
      border-radius: 999px;
      padding: 6px 12px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      color: var(--fg-muted);
      margin-bottom: 14px;
    }

    .splash-pill span {
      padding: 2px 8px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent);
      font-weight: 600;
    }

    .splash-cta {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      margin-top: 4px;
    }

    .btn-primary {
      border: none;
      cursor: pointer;
      padding: 10px 20px;
      border-radius: 999px;
      font-size: 0.94rem;
      font-weight: 600;
      background: radial-gradient(circle at top left, var(--accent), var(--accent-2));
      color: #0b1120;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 18px 48px rgba(251, 113, 133, 0.5);
      transition: transform var(--transition-fast), box-shadow var(--transition-fast), filter var(--transition-fast);
    }

    .btn-primary:hover {
      transform: translateY(-1px) scale(1.01);
      filter: brightness(1.06);
      box-shadow: 0 22px 58px rgba(251, 113, 133, 0.65);
    }

    .btn-primary span.icon {
      font-size: 1.15rem;
    }

    .splash-meta {
      font-size: 0.8rem;
      color: var(--fg-muted);
    }

    /* Top Nav */
    header {
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: blur(14px);
      background: linear-gradient(to bottom, rgba(15, 23, 42, 0.97), rgba(15, 23, 42, 0.9), transparent);
      border-bottom: 1px solid rgba(148, 163, 184, 0.35);
    }

    .nav {
      max-width: 1180px;
      margin: 0 auto;
      padding: 10px 16px;
      min-height: var(--nav-h);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .nav-left {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .nav-heart {
      width: 22px;
      height: 22px;
      border-radius: 50% 50% 45% 45%;
      background:
        radial-gradient(circle at 30% 30%, rgba(251, 113, 133, 1), transparent 60%),
        radial-gradient(circle at 70% 30%, rgba(251, 113, 133, 0.9), transparent 60%);
      transform: rotate(-45deg);
      box-shadow: var(--glow-strong);
      position: relative;
      overflow: hidden;
    }

    .nav-heart::after {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        conic-gradient(from 160deg,
          rgba(251, 113, 133, 0.7),
          transparent 40%,
          rgba(129, 140, 248, 0.7),
          transparent 75%,
          rgba(52, 211, 153, 0.85));
      opacity: 0.4;
      animation: orbSpin 18s linear infinite;
    }

    .nav-title-wrap {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .nav-title {
      font-size: 0.96rem;
      font-weight: 600;
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }

    .nav-sub {
      font-size: 0.76rem;
      color: var(--fg-muted);
    }

    .nav-center {
      display: flex;
      align-items: center;
      gap: 6px;
      flex: 1;
      justify-content: center;
    }

    .nav-link {
      font-size: 0.78rem;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid transparent;
      color: var(--fg-muted);
      background: transparent;
      cursor: pointer;
      transition: background var(--transition-fast), border-color var(--transition-fast), color var(--transition-fast), transform var(--transition-fast);
      white-space: nowrap;
    }

    .nav-link:hover {
      background: rgba(15, 23, 42, 0.82);
      border-color: rgba(148, 163, 184, 0.7);
      color: var(--fg);
      transform: translateY(-1px);
    }

    .nav-link.active {
      color: var(--accent);
      border-color: rgba(251, 113, 133, 0.7);
      background: rgba(15, 23, 42, 0.9);
    }

    .nav-right {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .nav-chip {
      font-size: 0.72rem;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.92);
      border: 1px solid rgba(148, 163, 184, 0.7);
      color: var(--fg-muted);
      cursor: default;
    }

    .toggle {
      border-radius: 999px;
      padding: 4px 8px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.94);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      cursor: pointer;
      font-size: 0.72rem;
      color: var(--fg-muted);
    }

    .toggle-knob {
      width: 16px;
      height: 16px;
      border-radius: 999px;
      background: var(--accent-soft);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      color: var(--accent);
    }

    /* Layout */
    .shell {
      max-width: 1180px;
      margin: 0 auto;
      padding: 18px 16px 40px;
    }

    section {
      margin-bottom: 16px;
    }

    .hero {
      margin-top: 10px;
      margin-bottom: 18px;
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 1.2fr);
      gap: 14px;
      align-items: stretch;
    }

    .section-card {
      background: linear-gradient(145deg, rgba(15, 23, 42, 0.97), rgba(15, 23, 42, 0.95));
      border-radius: var(--radius-xl);
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      padding: 16px 14px;
      position: relative;
      overflow: hidden;
    }

    .section-card::before {
      content: "";
      position: absolute;
      inset: -30%;
      background:
        radial-gradient(circle at 0% 0%, rgba(251, 113, 133, 0.26), transparent 60%),
        radial-gradient(circle at 85% 10%, rgba(129, 140, 248, 0.26), transparent 60%),
        radial-gradient(circle at 30% 100%, rgba(52, 211, 153, 0.3), transparent 60%);
      opacity: 0.42;
      filter: blur(20px);
      mix-blend-mode: screen;
    }

    .card-inner {
      position: relative;
      z-index: 1;
    }

    .hero-main {
      border-radius: var(--radius-xl);
    }

    .hero-kicker {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      color: var(--accent);
      margin-bottom: 6px;
    }

    .hero-title {
      font-size: clamp(1.4rem, 1.8rem, 2.1rem);
      font-weight: 700;
      margin-bottom: 8px;
    }

    .hero-subtitle {
      font-size: 0.95rem;
      color: var(--fg-muted);
      max-width: 36rem;
      margin-bottom: 12px;
    }

    .hero-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      margin-bottom: 10px;
    }

    .hero-pill {
      font-size: 0.76rem;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(148, 163, 184, 0.7);
      color: var(--fg-muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .hero-pill span {
      padding: 3px 8px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent);
      font-weight: 600;
    }

    .hero-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 9px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(148, 163, 184, 0.6);
      font-size: 0.76rem;
      color: var(--fg-muted);
    }

    .hero-badge-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--success);
      box-shadow: 0 0 12px rgba(74, 222, 128, 0.9);
    }

    .hero-metrics {
      margin-top: 10px;
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;
    }

    .metric {
      background: rgba(15, 23, 42, 0.97);
      border-radius: 16px;
      padding: 10px 10px 9px;
      border: 1px solid rgba(148, 163, 184, 0.55);
      display: flex;
      flex-direction: column;
      gap: 2px;
      font-size: 0.78rem;
    }

    .metric-label {
      color: var(--fg-muted);
    }

    .metric-value {
      font-size: 1.02rem;
      font-weight: 600;
    }

    .metric-trend {
      font-size: 0.75rem;
    }

    .metric-trend.positive {
      color: var(--success);
    }

    .metric-trend.calm {
      color: var(--accent-3);
    }

    .hero-side {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .panel {
      background: linear-gradient(145deg, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 0.96));
      border-radius: 18px;
      padding: 14px 13px;
      border: 1px solid rgba(148, 163, 184, 0.55);
      box-shadow: var(--shadow-soft);
    }

    .panel-title {
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
    }

    .panel-title span.icon {
      font-size: 1.1rem;
    }

    .panel-body {
      font-size: 0.82rem;
      color: var(--fg-muted);
      line-height: 1.6;
    }

    .panel-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 0.8rem;
      margin-top: 8px;
      color: var(--fg-muted);
    }

    .pill-soft {
      padding: 3px 7px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent);
      font-size: 0.75rem;
      border: 1px solid rgba(148, 163, 184, 0.5);
    }

    /* Search */
    .search-bar {
      margin: 18px 0 12px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }

    .search-input-wrap {
      flex: 1;
      min-width: 210px;
      position: relative;
    }

    .search-input-wrap input {
      width: 100%;
      padding: 8px 30px 8px 26px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.97);
      color: var(--fg);
      font-size: 0.8rem;
      outline: none;
      transition: border-color var(--transition-fast), box-shadow var(--transition-fast), background var(--transition-fast);
    }

    .search-input-wrap input:focus {
      border-color: rgba(251, 113, 133, 0.9);
      box-shadow: 0 0 0 1px rgba(251, 113, 133, 0.4);
      background: rgba(15, 23, 42, 0.99);
    }

    .search-input-wrap .icon {
      position: absolute;
      left: 9px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.9rem;
      color: var(--fg-muted);
    }

    .search-input-wrap .clear {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.8rem;
      cursor: pointer;
      color: var(--fg-muted);
      display: none;
    }

    .search-input-wrap .clear.visible {
      display: block;
    }

    .search-meta {
      font-size: 0.76rem;
      color: var(--fg-muted);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .search-meta span {
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.92);
    }

    .search-match {
      outline: 1px solid rgba(251, 113, 133, 0.7);
      box-shadow: 0 0 0 1px rgba(251, 113, 133, 0.35);
    }

    /* Lattice + aura/heartline canvas container */
    .grid {
      display: grid;
      grid-template-columns: minmax(0, 1.45fr) minmax(0, 1.1fr);
      gap: 14px;
      align-items: stretch;
    }

    .subcard {
      background: linear-gradient(145deg, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 0.96));
      border-radius: 18px;
      border: 1px solid var(--border-subtle);
      padding: 14px 13px 12px;
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
    }

    .subcard-inner {
      position: relative;
      z-index: 1;
    }

    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 8px;
    }

    .section-title {
      font-size: 0.95rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 7px;
    }

    .section-title span.icon {
      font-size: 1.1rem;
    }

    .section-tagline {
      font-size: 0.8rem;
      color: var(--fg-muted);
    }

    .section-body {
      font-size: 0.82rem;
      color: var(--fg-muted);
      line-height: 1.6;
    }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 10px;
    }

    .chip {
      padding: 3px 7px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.94);
      border: 1px solid rgba(148, 163, 184, 0.6);
      font-size: 0.76rem;
      color: var(--fg-muted);
    }

    .spark-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 8px;
    }

    .spark {
      flex: 1;
      min-width: 140px;
      background: rgba(15, 23, 42, 0.97);
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      padding: 5px 8px;
      font-size: 0.75rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
    }

    .spark-label {
      color: var(--fg-muted);
    }

    .spark-meter {
      flex: 1;
      height: 4px;
      border-radius: 999px;
      background: rgba(31, 41, 55, 0.9);
      overflow: hidden;
      position: relative;
      margin-left: 4px;
    }

    .spark-fill {
      position: absolute;
      inset: 0;
      border-radius: 999px;
      background: linear-gradient(to right, var(--accent), var(--accent-3));
      transform-origin: left center;
      transform: scaleX(0.7);
      transition: transform 600ms ease-out;
    }

    .spark-value {
      font-size: 0.75rem;
      color: var(--accent-3);
      margin-left: 6px;
    }

    /* Aura + heartline canvas */
    .field-vis-container {
      position: relative;
      border-radius: 16px;
      overflow: hidden;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 0.96));
      height: 280px;
    }

    #fieldCanvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    .field-overlay-note {
      position: absolute;
      left: 10px;
      bottom: 10px;
      font-size: 0.7rem;
      color: var(--fg-muted);
      background: rgba(15, 23, 42, 0.92);
      border-radius: 999px;
      padding: 3px 8px;
      border: 1px solid rgba(148, 163, 184, 0.6);
    }

    .region-list {
      margin-top: 8px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .region-pill {
      font-size: 0.76rem;
      padding: 5px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.95);
      color: var(--fg-muted);
      cursor: pointer;
      transition: background var(--transition-fast), border-color var(--transition-fast), color var(--transition-fast), transform var(--transition-fast);
    }

    .region-pill:hover {
      transform: translateY(-1px);
      background: rgba(15, 23, 42, 0.98);
    }

    .region-pill.active {
      border-color: rgba(251, 113, 133, 0.9);
      color: var(--accent);
      background: rgba(24, 24, 35, 0.98);
    }

    .region-details {
      margin-top: 8px;
      border-radius: 14px;
      border: 1px solid rgba(148, 163, 184, 0.55);
      background: rgba(15, 23, 42, 0.97);
      padding: 8px 9px;
      font-size: 0.8rem;
      color: var(--fg-muted);
      line-height: 1.6;
    }

    /* Log + practice */
    .log {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.74rem;
      background: rgba(15, 23, 42, 0.98);
      border-radius: 14px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      padding: 8px 8px 6px;
      color: var(--fg-muted);
      max-height: 220px;
      overflow: auto;
      line-height: 1.45;
    }

    .log-line + .log-line {
      margin-top: 2px;
    }

    .practice-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 8px;
    }

    .practice-item {
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.55);
      background: rgba(15, 23, 42, 0.97);
      padding: 6px 7px;
      font-size: 0.8rem;
      color: var(--fg-muted);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .practice-icon {
      font-size: 0.95rem;
    }

    /* Collapsibles */
    .collapsible-toggle {
      font-size: 0.75rem;
      border-radius: 999px;
      padding: 3px 8px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.94);
      color: var(--fg-muted);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }

    .collapsible-toggle span.icon {
      font-size: 0.85rem;
    }

    .collapsible-content {
      margin-top: 8px;
    }

    .collapsible-content[data-collapsed="true"] {
      display: none;
    }

    /* Footer */
    footer {
      margin-top: 20px;
      padding-top: 12px;
      border-top: 1px solid rgba(148, 163, 184, 0.45);
      font-size: 0.75rem;
      color: var(--fg-muted);
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 6px;
    }

    footer strong {
      color: var(--accent);
      font-weight: 600;
    }

    /* Print */
    @media print {
      .splash,
      header,
      .search-bar,
      .parallax-bg,
      .star-layer {
        display: none !important;
      }
      body {
        background: #ffffff;
        color: #000000;
      }
      .shell {
        max-width: none;
        padding: 0;
      }
      .section-card,
      .subcard,
      .panel {
        box-shadow: none;
        border-radius: 0;
        border: none;
        background: #ffffff;
      }
    }

    /* Responsive */
    @media (max-width: 880px) {
      .hero {
        grid-template-columns: minmax(0, 1fr);
      }
      .grid {
        grid-template-columns: minmax(0, 1fr);
      }
      .nav-center {
        display: none;
      }
      .shell {
        padding-inline: 12px;
      }
    }

    @media (max-width: 540px) {
      .hero-metrics {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
      .section-card,
      .subcard {
        padding: 12px 11px;
      }
      .splash-inner {
        padding: 24px 18px;
      }
      .splash-title {
        font-size: 1.6rem;
      }
      .field-vis-container {
        height: 240px;
      }
    }

    /* Animations */
    @keyframes splashAura {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    @keyframes orbSpin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <!--
    Zero-Harm / Anti-Inversion Note:
    This Soft Power Field module is designed for emotional safety,
    conflict de-escalation, and regenerative soft power only.
    It must never be used for manipulation, coercion, or harm.
    ‚Äî Foster + Navi ¬∑ Peace Lattice ¬∑ Aphrodite Engine
  -->

  <noscript>
    <div style="background:#111827;color:#e5e7eb;padding:12px;text-align:center;font-family:system-ui,-apple-system,BlinkMacSystemFont,'SF Pro Text','Inter',sans-serif;font-size:0.85rem;">
      This module uses a small amount of JavaScript for visualisation, search, and local preferences.
      With JavaScript disabled you can still read the content, but interactive features will not function.
    </div>
  </noscript>

  <div class="parallax-bg" id="parallax-bg"></div>
  <div class="star-layer" id="star-layer"></div>

  <!-- Splash -->
  <div class="splash" id="splash">
    <div class="splash-inner">
      <div class="splash-frame">
        <div class="splash-logo">
          <span class="splash-logo-orb"></span>
          Peace Lattice ¬∑ Soft Power Field
        </div>
        <div class="splash-title">Aphrodite Engine</div>
        <div class="splash-subtitle">
          A visualisation of the invisible: how tenderness, stories, and quiet decisions
          ripple across an emotional mesh of hearts, cities, and nations.
        </div>
        <div class="splash-pill">
          Structural Intent:
          <span>Gentleness At Scale</span>
        </div>
        <div class="splash-cta">
          <button class="btn-primary" id="enterSoftField">
            <span class="icon">üíó</span>
            <span>Enter the Soft Power Field</span>
          </button>
          <div class="splash-meta">
            All state is stored locally in your browser via IndexedDB.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Header -->
  <header>
    <div class="nav">
      <div class="nav-left">
        <div class="nav-heart"></div>
        <div class="nav-title-wrap">
          <div class="nav-title">Soft Power Field</div>
          <div class="nav-sub">Aphrodite Engine ¬∑ Emotional Mesh Prototype</div>
        </div>
      </div>
      <div class="nav-center">
        <button class="nav-link active" data-scroll-target="section-overview">Overview</button>
        <button class="nav-link" data-scroll-target="section-field">Field Map</button>
        <button class="nav-link" data-scroll-target="section-metrics">Metrics</button>
        <button class="nav-link" data-scroll-target="section-practice">Practice Lab</button>
        <button class="nav-link" data-scroll-target="section-research">Research</button>
      </div>
      <div class="nav-right">
        <div class="nav-chip">Module ¬∑ Local Only</div>
        <button class="toggle" id="themeToggle" type="button">
          <span class="toggle-knob" id="themeIcon">üåô</span>
          <span id="themeLabel">Dark</span>
        </button>
        <button class="toggle" id="autopilotToggle" type="button">
          <span class="toggle-knob">üí´</span>
          <span id="autopilotLabel">Amplifier: Off</span>
        </button>
      </div>
    </div>
  </header>

  <main>
    <div class="shell">
      <!-- Hero -->
      <section class="hero section-card" id="section-overview" data-search="soft power aphrodite field empathy narrative safety feminist peace theory emotional contagion">
        <div class="card-inner hero-main">
          <div class="hero-kicker">Soft Power Field ¬∑ Overview</div>
          <h1 class="hero-title">When one person‚Äôs gentleness steadies entire timelines.</h1>
          <p class="hero-subtitle">
            In the narrative, Aphrodite sits on the floor with a candle and decides:
            <em>‚ÄúIf he‚Äôs working for peace, then I‚Äôll become peace.‚Äù</em>
            This engine turns that choice into a model: a hybrid aura-and-heartline mesh where
            emotional resonance travels across communities, cities, and nations.
          </p>
          <div class="hero-row">
            <div class="hero-pill">
              Field State:
              <span id="fieldState">Warm ¬∑ Expanding</span>
            </div>
            <div class="hero-badge">
              <span class="hero-badge-dot"></span>
              Emotional Mesh: <strong style="margin-left:4px;">Coherent</strong>
            </div>
          </div>

          <div class="hero-metrics">
            <div class="metric">
              <div class="metric-label">Global Empathy Index</div>
              <div class="metric-value" id="empathyIndex">0.74</div>
              <div class="metric-trend positive" id="empathyTrend">‚ñ≤ rising</div>
            </div>
            <div class="metric">
              <div class="metric-label">Narrative Calm</div>
              <div class="metric-value" id="calmIndex">0.69</div>
              <div class="metric-trend calm" id="calmTrend">‚âà steady</div>
            </div>
            <div class="metric">
              <div class="metric-label">Perceived Safety</div>
              <div class="metric-value" id="safetyIndex">0.62</div>
              <div class="metric-trend positive" id="safetyTrend">‚ñ≤ strengthening</div>
            </div>
          </div>
        </div>

        <aside class="hero-side">
          <div class="panel">
            <div class="panel-title">
              <span><span class="icon">üåÄ</span> Hybrid Field</span>
              <span class="pill-soft">Aura + Heartline</span>
            </div>
            <div class="panel-body">
              The visual field combines:
              <ul style="margin-top:6px;padding-left:16px;">
                <li>Blooming auras (petals) around regions where care is rising, and</li>
                <li>Heartline paths connecting those regions through stories, art, and trust.</li>
              </ul>
              Each pulse in the mesh represents a quiet decision to be kinder than the moment requires.
            </div>
            <div class="panel-row">
              <span>Source: <strong>Lived Soft Power</strong></span>
              <span>Plane: <strong>Emotional</strong></span>
            </div>
          </div>

          <div class="panel">
            <div class="panel-title">
              <span><span class="icon">üìÅ</span> Local Preferences</span>
            </div>
            <div class="panel-body">
              Theme, amplifier state, and last selected region are held in IndexedDB.
              No external data is fetched; this is a self-contained exploration of how gentle power
              might be tracked and strengthened.
            </div>
            <div class="panel-row">
              <span>Storage: <strong>IndexedDB</strong></span>
              <span id="dbStatus">DB: initialising‚Ä¶</span>
            </div>
          </div>
        </aside>
      </section>

      <!-- Search -->
      <div class="search-bar">
        <div class="search-input-wrap">
          <span class="icon">üîç</span>
          <input id="searchInput" type="search" placeholder="Search the soft power lattice (e.g. ‚Äòfeminist peace‚Äô, ‚Äòemotional contagion‚Äô, ‚Äòmicro-gesture‚Äô)‚Ä¶" />
          <span class="clear" id="searchClear">‚úï</span>
        </div>
        <div class="search-meta">
          <span id="searchCount">0 matches</span>
          <span>Search is client-side ¬∑ nothing leaves your device.</span>
        </div>
      </div>

      <!-- Field + details -->
      <div class="grid">
        <!-- Field visual -->
        <section class="subcard" id="section-field" data-search="field map hybrid aura heartline regions emotional mesh connectivity">
          <div class="subcard-inner">
            <div class="section-header">
              <div>
                <div class="section-title">
                  <span class="icon">üíì</span>
                  Soft Power Field Map
                </div>
                <div class="section-tagline">
                  Hybrid aura + heartline map of tenderness at scale.
                </div>
              </div>
              <button class="collapsible-toggle" data-target="fieldNotes">
                <span class="icon">‚ñæ</span>
                Notes
              </button>
            </div>
            <div class="section-body">
              <p>
                Each node in the map is a region of emotional influence ‚Äî not just geography,
                but also cultural clusters and digital commons. Auras show warmth; heartlines
                show relationship density and story flow. Pulses represent real or potential
                acts of empathy.
              </p>
            </div>

            <div class="field-vis-container" aria-label="Soft power aura and heartline field visualisation">
              <canvas id="fieldCanvas"></canvas>
              <div class="field-overlay-note">
                Click near a node or choose a region below to focus its aura.
              </div>
            </div>

            <div class="region-list" id="regionList">
              <!-- populated by JS -->
            </div>

            <div class="region-details" id="regionDetails">
              Select a region to see how soft power flows there.
            </div>

            <div class="collapsible-content" id="fieldNotes" data-collapsed="true">
              <p style="margin-top:8px;">
                Methodologically, this field can stand in for:
              </p>
              <ul style="margin-top:4px;padding-left:16px;">
                <li>networks of mutual aid and care work,</li>
                <li>diaspora and cultural exchange corridors,</li>
                <li>and digital communities that stabilise people during crises.</li>
              </ul>
            </div>
          </div>
        </section>

        <!-- Metrics / spark -->
        <section class="subcard" id="section-metrics" data-search="metrics empathy index narrative calm perceived safety connection density">
          <div class="subcard-inner">
            <div class="section-header">
              <div>
                <div class="section-title">
                  <span class="icon">üìä</span>
                  Soft Power Metrics
                </div>
                <div class="section-tagline">
                  Approximate curves of a feeling.
                </div>
              </div>
              <button class="collapsible-toggle" data-target="metricNotes">
                <span class="icon">‚ñæ</span>
                Details
              </button>
            </div>
            <div class="section-body">
              <p>
                Traditional dashboards track hard indicators: troop movements, economic shocks,
                media spikes. This panel asks different questions:
                How kind is the average sentence today? How many people feel held instead of hunted?
              </p>

              <div class="spark-row">
                <div class="spark">
                  <span class="spark-label">Connection Density</span>
                  <div class="spark-meter">
                    <div class="spark-fill" id="sparkConn"></div>
                  </div>
                  <span class="spark-value" id="sparkConnVal">0.71</span>
                </div>
                <div class="spark">
                  <span class="spark-label">Moral Elevation</span>
                  <div class="spark-meter">
                    <div class="spark-fill" id="sparkElev"></div>
                  </div>
                  <span class="spark-value" id="sparkElevVal">0.65</span>
                </div>
                <div class="spark">
                  <span class="spark-label">Psychological Safety</span>
                  <div class="spark-meter">
                    <div class="spark-fill" id="sparkSafe"></div>
                  </div>
                  <span class="spark-value" id="sparkSafeVal">0.59</span>
                </div>
              </div>

              <div class="collapsible-content" id="metricNotes" data-collapsed="true">
                <p style="margin-top:8px;">
                  These values are illustrative, but they map to real-world constructs:
                </p>
                <ul style="margin-top:4px;padding-left:16px;">
                  <li><strong>Connection Density</strong> ¬∑ overlapping social ties and support networks,</li>
                  <li><strong>Moral Elevation</strong> ¬∑ how often people see others being kind,</li>
                  <li><strong>Psychological Safety</strong> ¬∑ how safe it feels to speak and be.</li>
                </ul>
              </div>
            </div>
          </div>
        </section>
      </div>

      <!-- Practice + log -->
      <div class="grid">
        <section class="subcard" id="section-practice" data-search="practice lab daily soft power micro gestures interventions">
          <div class="subcard-inner">
            <div class="section-header">
              <div>
                <div class="section-title">
                  <span class="icon">ü™¥</span>
                  Soft Power Practice Lab
                </div>
                <div class="section-tagline">
                  Small rituals to warm the mesh.
                </div>
              </div>
              <button class="collapsible-toggle" data-target="practiceMore">
                <span class="icon">‚ñæ</span>
                More
              </button>
            </div>
            <div class="section-body">
              <p>
                These are single-person actions that behave like field amplifiers when repeated
                across millions of lives. None require status, money, or permission ‚Äî only
                intention and consistency.
              </p>

              <div class="practice-list" id="practiceList">
                <!-- populated by JS -->
              </div>

              <div class="collapsible-content" id="practiceMore" data-collapsed="true">
                <p style="margin-top:8px;">
                  In research language, this lab touches moral elevation, prosocial contagion,
                  and ‚Äúslow, boring heroism‚Äù: the daily choice to be softer than the world expects.
                </p>
              </div>
            </div>
          </div>
        </section>

        <section class="subcard" id="section-research" data-search="research feminist ir emotional contagion narrative framing trauma informed diplomacy">
          <div class="subcard-inner">
            <div class="section-header">
              <div>
                <div class="section-title">
                  <span class="icon">üìö</span>
                  Research Notes ¬∑ Soft Power Field
                </div>
                <div class="section-tagline">
                  Translating myth into methodology.
                </div>
              </div>
            </div>
            <div class="section-body">
              <p>
                The Autopilot log here imagines a future where this module connects to live data:
                crisis lines, media sentiment, community projects. For now, it writes gentle,
                fictional system messages to illustrate the kinds of interventions soft power could support.
              </p>

              <div class="log" id="autopilotLog" aria-live="polite">
                <div class="log-line">[boot] Aphrodite Engine initialised.</div>
                <div class="log-line">[hint] Toggle üí´ Amplifier to simulate field pulses across the heartline mesh.</div>
              </div>

              <div style="margin-top:8px;font-size:0.78rem;color:var(--fg-muted);">
                Under the hood, this module conceptually touches:
                <ul style="margin-top:4px;padding-left:16px;">
                  <li>emotional contagion &amp; affective science,</li>
                  <li>feminist international relations &amp; care ethics,</li>
                  <li>narrative framing and media effects,</li>
                  <li>trauma-informed diplomacy and de-escalation.</li>
                </ul>
              </div>
            </div>
          </div>
        </section>
      </div>

      <footer>
        <div>
          <strong>Zero-Harm Intent:</strong>
          This engine exists only to strengthen empathy, safety, and gentle influence.
          It is never to be used for surveillance, coercion, or manipulation.
        </div>
        <div>
          Structural whisper from the field: <strong>Everything is going to be more than okay.</strong>
        </div>
      </footer>
    </div>
  </main>

  <script>
    // =====================================================
    // Soft Power Field ¬∑ Aphrodite Engine
    // Local logic ¬∑ IndexedDB settings ¬∑ Hybrid field canvas
    // =====================================================
    (function () {
      const root = document.documentElement;
      const splash = document.getElementById("splash");
      const enterBtn = document.getElementById("enterSoftField");
      const parallaxBg = document.getElementById("parallax-bg");
      const starLayer = document.getElementById("star-layer");

      const themeToggle = document.getElementById("themeToggle");
      const themeIcon = document.getElementById("themeIcon");
      const themeLabel = document.getElementById("themeLabel");

      const autopilotToggle = document.getElementById("autopilotToggle");
      const autopilotLabel = document.getElementById("autopilotLabel");
      const autopilotLog = document.getElementById("autopilotLog");

      const navLinks = Array.from(document.querySelectorAll(".nav-link"));
      const sections = Array.from(document.querySelectorAll("section.section-card, section.subcard"));

      const searchInput = document.getElementById("searchInput");
      const searchClear = document.getElementById("searchClear");
      const searchCount = document.getElementById("searchCount");

      const dbStatusEl = document.getElementById("dbStatus");

      const empathyIndexEl = document.getElementById("empathyIndex");
      const empathyTrendEl = document.getElementById("empathyTrend");
      const calmIndexEl = document.getElementById("calmIndex");
      const calmTrendEl = document.getElementById("calmTrend");
      const safetyIndexEl = document.getElementById("safetyIndex");
      const safetyTrendEl = document.getElementById("safetyTrend");
      const fieldStateEl = document.getElementById("fieldState");

      const sparkConn = document.getElementById("sparkConn");
      const sparkConnVal = document.getElementById("sparkConnVal");
      const sparkElev = document.getElementById("sparkElev");
      const sparkElevVal = document.getElementById("sparkElevVal");
      const sparkSafe = document.getElementById("sparkSafe");
      const sparkSafeVal = document.getElementById("sparkSafeVal");

      const regionListEl = document.getElementById("regionList");
      const regionDetailsEl = document.getElementById("regionDetails");
      const practiceListEl = document.getElementById("practiceList");

      const canvas = document.getElementById("fieldCanvas");
      const ctx = canvas.getContext ? canvas.getContext("2d") : null;

      let autopilot = false;
      let autopilotTimer = null;
      let metricsTimer = null;
      let db = null;

      // region data
      const regions = [
        {
          id: "eastern-europe",
          label: "Eastern Europe",
          x: 0.28, y: 0.32,
          warmth: 0.68,
          resonance: 0.72,
          note: "Where frontline courage meets quiet civilian care: neighbours sharing generators, volunteers translating, strangers offering rides at borders."
        },
        {
          id: "global-south",
          label: "Global South",
          x: 0.62, y: 0.62,
          warmth: 0.75,
          resonance: 0.69,
          note: "Mutual aid traditions, community kitchens, and intergenerational care make this field rich with soft power that predates most treaties."
        },
        {
          id: "digital-commons",
          label: "Digital Commons",
          x: 0.5, y: 0.18,
          warmth: 0.71,
          resonance: 0.78,
          note: "Stream chats, group DMs, community servers, and quiet mod teams keeping spaces safe ‚Äî an invisible diplomacy layer for millions."
        },
        {
          id: "local-neighbourhoods",
          label: "Local Neighbourhoods",
          x: 0.2, y: 0.65,
          warmth: 0.73,
          resonance: 0.66,
          note: "Hallway nods, shared tools, snow shovelling, and 'you okay?' texts. Micro-relations that prevent macro-level despair."
        },
        {
          id: "diaspora-bridges",
          label: "Diaspora Bridges",
          x: 0.78, y: 0.28,
          warmth: 0.77,
          resonance: 0.81,
          note: "People living between places, translating worlds for each other, sending remittances, and carrying stories both ways."
        },
        {
          id: "cultural-frontlines",
          label: "Cultural Frontlines",
          x: 0.38, y: 0.52,
          warmth: 0.69,
          resonance: 0.74,
          note: "Musicians, game devs, writers, and streamers who accidentally become peace ambassadors simply by making people feel less alone."
        }
      ];

      const practiceItems = [
        "Before reading the news, place a hand on your chest and set a quiet intention: may everyone in this headline be safe.",
        "Respond to one sharp message today with grounded kindness instead of escalation.",
        "Share a story of someone doing good, not just someone doing harm.",
        "Message a person who holds community together and thank them for the emotional labour you rarely name.",
        "In one conversation, choose to really listen without rehearsing your reply.",
        "When you notice yourself spiralling, pause and imagine sending steadiness to someone else who might be spiralling too.",
        "Amplify a small creator whose work makes people feel less alone.",
        "Privately forgive a stranger who hurt you in passing and release the story from your nervous system."
      ];

      // ========= Parallax =========
      function handleParallax() {
        const y = window.scrollY || 0;
        const slow = -(y * 0.04);
        const slower = -(y * 0.02);
        if (parallaxBg) parallaxBg.style.transform = "translate3d(0," + slow + "px,0)";
        if (starLayer) starLayer.style.transform = "translate3d(0," + slower + "px,0)";
      }
      window.addEventListener("scroll", handleParallax, { passive: true });

      // ========= Splash =========
      function hideSplash() {
        if (!splash) return;
        splash.classList.add("hidden");
      }

      if (enterBtn) {
        enterBtn.addEventListener("click", () => {
          hideSplash();
          logLine("[user] Entered Soft Power Field.");
          saveSetting("hasEntered", true);
        });
      }

      setTimeout(() => {
        if (!splash.classList.contains("hidden")) {
          hideSplash();
          logLine("[auto] Splash dismissed after grace period.");
        }
      }, 9000);

      // ========= Nav =========
      function scrollToTarget(id) {
        const el = document.getElementById(id);
        if (!el) return;
        const rect = el.getBoundingClientRect();
        const offset = window.pageYOffset + rect.top - 86;
        window.scrollTo({ top: offset, behavior: "smooth" });
      }

      navLinks.forEach(btn => {
        btn.addEventListener("click", () => {
          const target = btn.getAttribute("data-scroll-target");
          if (target) scrollToTarget(target);
        });
      });

      function updateActiveNav() {
        const offset = window.pageYOffset;
        let currentId = "section-overview";
        sections.forEach(sec => {
          const rect = sec.getBoundingClientRect();
          const top = rect.top + window.pageYOffset - 110;
          if (offset >= top) {
            currentId = sec.id;
          }
        });
        navLinks.forEach(btn => {
          const target = btn.getAttribute("data-scroll-target");
          btn.classList.toggle("active", target === currentId);
        });
      }
      window.addEventListener("scroll", () => updateActiveNav(), { passive: true });

      // ========= IndexedDB =========
      function openDB() {
        if (!("indexedDB" in window)) {
          dbStatusEl.textContent = "DB: unavailable";
          return;
        }
        const request = indexedDB.open("softPowerFieldDB", 1);
        request.onupgradeneeded = function (event) {
          const db = event.target.result;
          if (!db.objectStoreNames.contains("settings")) {
            db.createObjectStore("settings", { keyPath: "key" });
          }
        };
        request.onsuccess = function (event) {
          db = event.target.result;
          dbStatusEl.textContent = "DB: ready";
          loadSettings();
        };
        request.onerror = function () {
          dbStatusEl.textContent = "DB: error";
        };
      }

      function saveSetting(key, value) {
        if (!db) return;
        const tx = db.transaction("settings", "readwrite");
        const store = tx.objectStore("settings");
        store.put({ key, value });
      }

      function loadSettings() {
        if (!db) return;
        const tx = db.transaction("settings", "readonly");
        const store = tx.objectStore("settings");
        const request = store.getAll();
        request.onsuccess = function (event) {
          const items = event.target.result || [];
          items.forEach(({ key, value }) => {
            if (key === "theme") applyTheme(value, false);
            if (key === "amplifier") setAutopilot(Boolean(value), false);
            if (key === "lastRegion") focusRegionById(value, false);
          });
        };
      }

      openDB();

      // ========= Theme =========
      function detectPreferredTheme() {
        if (window.matchMedia && window.matchMedia("(prefers-color-scheme: light)").matches) {
          return "light";
        }
        return "dark";
      }

      function applyTheme(theme, persist = true) {
        if (theme === "light") {
          root.setAttribute("data-theme", "light");
          themeIcon.textContent = "‚òÄÔ∏è";
          themeLabel.textContent = "Light";
        } else {
          root.setAttribute("data-theme", "dark");
          themeIcon.textContent = "üåô";
          themeLabel.textContent = "Dark";
        }
        if (persist) saveSetting("theme", theme);
      }

      themeToggle.addEventListener("click", () => {
        const current = root.getAttribute("data-theme") === "light" ? "light" : "dark";
        const next = current === "light" ? "dark" : "light";
        applyTheme(next);
        logLine("[user] Theme switched to " + next + ".");
      });

      const initialTheme = detectPreferredTheme();
      applyTheme(initialTheme, false);

      // ========= Metrics =========
      function randBetween(min, max) {
        return Math.random() * (max - min) + min;
      }

      function formatFloat(num, d) {
        return num.toFixed(d);
      }

      function updateHeroMetrics() {
        const empathy = randBetween(0.7, 0.81);
        const calm = randBetween(0.66, 0.76);
        const safety = randBetween(0.6, 0.7);

        empathyIndexEl.textContent = formatFloat(empathy, 2);
        empathyTrendEl.textContent = empathy > 0.75 ? "‚ñ≤ rising" : "‚âà steady";
        calmIndexEl.textContent = formatFloat(calm, 2);
        calmTrendEl.textContent = calm > 0.7 ? "‚ñ≤ softening" : "‚âà steady";
        safetyIndexEl.textContent = formatFloat(safety, 2);
        safetyTrendEl.textContent = safety > 0.65 ? "‚ñ≤ strengthening" : "‚âà steady";

        if (empathy > 0.76 && safety > 0.65) {
          fieldStateEl.textContent = "Warm ¬∑ Deepening";
        } else {
          fieldStateEl.textContent = "Warm ¬∑ Expanding";
        }

        const conn = randBetween(0.68, 0.8);
        const elev = randBetween(0.62, 0.75);
        const safe = randBetween(0.57, 0.68);

        sparkConn.style.transform = "scaleX(" + conn.toFixed(2) + ")";
        sparkConnVal.textContent = formatFloat(conn, 2);
        sparkElev.style.transform = "scaleX(" + elev.toFixed(2) + ")";
        sparkElevVal.textContent = formatFloat(elev, 2);
        sparkSafe.style.transform = "scaleX(" + safe.toFixed(2) + ")";
        sparkSafeVal.textContent = formatFloat(safe, 2);
      }

      metricsTimer = setInterval(updateHeroMetrics, 3800);
      updateHeroMetrics();

      // ========= Regions + practice =========
      function renderRegions() {
        regionListEl.innerHTML = "";
        regions.forEach(r => {
          const btn = document.createElement("button");
          btn.type = "button";
          btn.className = "region-pill";
          btn.textContent = r.label;
          btn.dataset.regionId = r.id;
          btn.addEventListener("click", () => focusRegion(r.id, true));
          regionListEl.appendChild(btn);
        });
      }

      function renderPractices() {
        practiceListEl.innerHTML = "";
        practiceItems.forEach((text, i) => {
          const div = document.createElement("div");
          div.className = "practice-item";
          const iconSpan = document.createElement("span");
          iconSpan.className = "practice-icon";
          iconSpan.textContent = i % 2 === 0 ? "‚ú®" : "üíû";
          const textSpan = document.createElement("span");
          textSpan.textContent = text;
          div.appendChild(iconSpan);
          div.appendChild(textSpan);
          practiceListEl.appendChild(div);
        });
      }

      renderRegions();
      renderPractices();

      function focusRegionById(id, persistSetting) {
        const region = regions.find(r => r.id === id);
        if (!region) return;
        // update pills
        Array.from(regionListEl.querySelectorAll(".region-pill")).forEach(p => {
          p.classList.toggle("active", p.dataset.regionId === id);
        });
        // update details
        regionDetailsEl.textContent = region.note +
          " Soft power warmth: " + formatFloat(region.warmth, 2) +
          " ¬∑ Resonance: " + formatFloat(region.resonance, 2) + ".";
        // nudge metrics visually
        fieldPulse(region);
        if (persistSetting) saveSetting("lastRegion", id);
      }

      function focusRegion(id, persist) {
        focusRegionById(id, persist);
        logLine("[mesh] Focus shifted to region: " + id + ".");
      }

      // ========= Canvas: aura + heartline =========
      let fieldNodes = [];
      let pulses = [];
      let resizeTimeout = null;

      function resizeCanvas() {
        if (!canvas || !ctx) return;
        const rect = canvas.getBoundingClientRect();
        const dpr = window.devicePixelRatio || 1;
        canvas.width = rect.width * dpr;
        canvas.height = rect.height * dpr;
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        buildNodes();
        drawField();
      }

      function buildNodes() {
        fieldNodes = regions.map(r => ({
          id: r.id,
          label: r.label,
          x: r.x,
          y: r.y,
          warmth: r.warmth,
          resonance: r.resonance
        }));
      }

      function addPulse(node, magnitude) {
        pulses.push({
          x: node.x,
          y: node.y,
          radius: 0.04 * magnitude,
          maxRadius: 0.36 * magnitude,
          alpha: 0.9,
          speed: 0.004 * magnitude
        });
      }

      function fieldPulse(region) {
        if (!canvas || !ctx) return;
        const node = fieldNodes.find(n => n.id === region.id);
        if (!node) return;
        addPulse(node, 1.3);
      }

      function drawField() {
        if (!canvas || !ctx) return;
        const w = canvas.clientWidth;
        const h = canvas.clientHeight;
        ctx.clearRect(0, 0, w, h);

        const grad = ctx.createRadialGradient(w * 0.5, h * 0.4, 0, w * 0.5, h * 0.4, Math.max(w, h) * 0.7);
        grad.addColorStop(0, "rgba(15,23,42,1)");
        grad.addColorStop(1, "rgba(2,6,23,0.96)");
        ctx.fillStyle = grad;
        ctx.fillRect(0, 0, w, h);

        // heartlines
        ctx.save();
        ctx.lineWidth = 1.2;
        fieldNodes.forEach((n, i) => {
          for (let j = i + 1; j < fieldNodes.length; j++) {
            const m = fieldNodes[j];
            const weight = (n.resonance + m.resonance) / 2;
            if (weight < 0.65) continue;
            const ax = n.x * w;
            const ay = n.y * h;
            const bx = m.x * w;
            const by = m.y * h;
            const dist = Math.hypot(ax - bx, ay - by);
            if (dist > Math.min(w, h) * 0.7) continue;
            const alpha = 0.08 + (weight - 0.6) * 0.6;
            const gradLine = ctx.createLinearGradient(ax, ay, bx, by);
            gradLine.addColorStop(0, "rgba(251,113,133," + alpha + ")");
            gradLine.addColorStop(1, "rgba(110,231,183," + (alpha * 0.9) + ")");
            ctx.strokeStyle = gradLine;
            ctx.beginPath();
            ctx.moveTo(ax, ay);
            const cx = (ax + bx) / 2;
            const cy = (ay + by) / 2 - 18;
            ctx.quadraticCurveTo(cx, cy, bx, by);
            ctx.stroke();
          }
        });
        ctx.restore();

        // auras
        fieldNodes.forEach(n => {
          const x = n.x * w;
          const y = n.y * h;
          const baseR = 34 + n.warmth * 32;
          const g = ctx.createRadialGradient(x, y, 0, x, y, baseR);
          g.addColorStop(0, "rgba(251,113,133,0.75)");
          g.addColorStop(0.45, "rgba(251,113,133,0.35)");
          g.addColorStop(1, "rgba(251,113,133,0)");
          ctx.fillStyle = g;
          ctx.beginPath();
          ctx.arc(x, y, baseR, 0, Math.PI * 2);
          ctx.fill();

          // petal-like overlay
          ctx.save();
          ctx.translate(x, y);
          const petals = 6;
          for (let i = 0; i < petals; i++) {
            ctx.rotate((Math.PI * 2) / petals);
            const pg = ctx.createLinearGradient(0, 0, 0, -baseR * 0.9);
            pg.addColorStop(0, "rgba(251,113,133,0.45)");
            pg.addColorStop(1, "rgba(251,113,133,0)");
            ctx.fillStyle = pg;
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.quadraticCurveTo(10, -baseR * 0.3, 0, -baseR * 0.9);
            ctx.quadraticCurveTo(-10, -baseR * 0.3, 0, 0);
            ctx.fill();
          }
          ctx.restore();
        });

        // pulses
        const now = Date.now();
        ctx.save();
        pulses.forEach(p => {
          p.radius += p.speed * Math.min(w, h);
          p.alpha = Math.max(0, 0.9 * (1 - p.radius / p.maxRadius));
        });
        pulses = pulses.filter(p => p.radius < p.maxRadius);

        pulses.forEach(p => {
          const x = p.x * w;
          const y = p.y * h;
          const r = p.radius * Math.min(w, h);
          ctx.strokeStyle = "rgba(251,113,133," + p.alpha + ")";
          ctx.lineWidth = 1.5;
          ctx.beginPath();
          ctx.arc(x, y, r, 0, Math.PI * 2);
          ctx.stroke();
        });
        ctx.restore();

        // nodes
        fieldNodes.forEach(n => {
          const x = n.x * w;
          const y = n.y * h;
          ctx.fillStyle = "#0b1120";
          ctx.beginPath();
          ctx.arc(x, y, 7, 0, Math.PI * 2);
          ctx.fill();
          const gradDot = ctx.createRadialGradient(x, y - 1, 0, x, y - 1, 7);
          gradDot.addColorStop(0, "rgba(248,250,252,1)");
          gradDot.addColorStop(1, "rgba(248,250,252,0.1)");
          ctx.fillStyle = gradDot;
          ctx.beginPath();
          ctx.arc(x, y, 6, 0, Math.PI * 2);
          ctx.fill();

          ctx.fillStyle = "rgba(248,250,252,0.86)";
          ctx.font = "11px " + getComputedStyle(document.body).fontFamily;
          ctx.textAlign = "center";
          ctx.fillText(n.label, x, y + 20);
        });
      }

      function animateField() {
        drawField();
        requestAnimationFrame(animateField);
      }

      window.addEventListener("resize", () => {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(resizeCanvas, 180);
      });

      resizeCanvas();
      if (ctx) animateField();

      // click interaction
      canvas.addEventListener("click", (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        const w = canvas.clientWidth;
        const h = canvas.clientHeight;

        let closest = null;
        let minDist = Infinity;
        fieldNodes.forEach(n => {
          const nx = n.x * w;
          const ny = n.y * h;
          const d = Math.hypot(nx - x, ny - y);
          if (d < minDist) {
            minDist = d;
            closest = n;
          }
        });
        if (closest && minDist < 80) {
          focusRegion(closest.id, true);
        }
      });

      // ========= Collapsibles =========
      const collapsibleButtons = Array.from(document.querySelectorAll(".collapsible-toggle"));
      collapsibleButtons.forEach(btn => {
        btn.addEventListener("click", () => {
          const targetId = btn.getAttribute("data-target");
          if (!targetId) return;
          const content = document.getElementById(targetId);
          if (!content) return;
          const collapsed = content.getAttribute("data-collapsed") === "true";
          content.setAttribute("data-collapsed", collapsed ? "false" : "true");
          const icon = btn.querySelector(".icon");
          if (icon) icon.textContent = collapsed ? "‚ñ¥" : "‚ñæ";
        });
      });

      // ========= Search =========
      function doSearch(value) {
        const q = (value || "").trim().toLowerCase();
        let matches = 0;
        sections.forEach(sec => {
          sec.classList.remove("search-match");
          if (!q) return;
          const text = (sec.getAttribute("data-search") || sec.textContent || "").toLowerCase();
          if (text.includes(q)) {
            sec.classList.add("search-match");
            matches++;
          }
        });
        searchCount.textContent = matches + " match" + (matches === 1 ? "" : "es");
      }

      searchInput.addEventListener("input", () => {
        const val = searchInput.value;
        doSearch(val);
        searchClear.classList.toggle("visible", !!val);
      });

      searchClear.addEventListener("click", () => {
        searchInput.value = "";
        searchClear.classList.remove("visible");
        doSearch("");
        }

        .empathy-meter {
            position: absolute;
            bottom: 2rem;
            right: 2rem;
            width: 260px;
            padding: 1.5rem;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(14px);
            border-radius: 1.2rem;
            border: 1px solid rgba(255,255,255,0.08);
            box-shadow: 0 0 22px rgba(255,255,255,0.05);
        }

        .meter-bar {
            width: 100%;
            height: 10px;
            background: rgba(255,255,255,0.15);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .meter-fill {
            width: 45%;
            height: 100%;
            background: var(--soft-gold);
            box-shadow: 0 0 12px var(--soft-gold);
            transition: width 1s ease;
        }

        .petal-node {
            position: absolute;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            background: var(--soft-pink);
            box-shadow: 0 0 14px var(--soft-pink);
            cursor: pointer;
            transition: transform 0.8s ease, background 0.8s ease;
        }

        .petal-node:hover {
            transform: scale(1.4);
            background: var(--soft-gold);
            box-shadow: 0 0 18px var(--soft-gold);
        }

        .heartline {
            position: absolute;
            width: 2px;
            background: linear-gradient(var(--soft-pink), var(--soft-gold));
            opacity: 0.35;
            transition: opacity 0.6s ease;
        }

        .heartline.active {
            opacity: 0.95;
            box-shadow: 0 0 12px var(--soft-gold);
        }

        .ap-field-surge {
            position: absolute;
            width: 12px;
            height: 12px;
            background: var(--soft-gold);
            border-radius: 50%;
            box-shadow: 0 0 18px var(--soft-gold);
            opacity: 0;
            pointer-events: none;
        }

        @keyframes surgePulse {
            0% {
                opacity: 1;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(9);
            }
        }

        @keyframes pageFade {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .research-panel {
            position: absolute;
            left: 2rem;
            bottom: 2rem;
            width: 340px;
            padding: 1rem 1.2rem;
            background: rgba(0,0,0,0.28);
            border-radius: 1rem;
            border: 1px solid rgba(255,255,255,0.09);
            font-size: 0.92rem;
            line-height: 1.35rem;
            color: rgba(255,255,255,0.9);
        }

        .research-panel h3 {
            margin-top: 0;
            font-size: 1.1rem;
            color: var(--soft-gold);
        }
    </style>
</head>
<body>

    <div class="splash" id="splash">
        <h1>Aphrodite Soft Power Field</h1>
        <p>Emotional resonance as a diplomacy engine</p>
        <div class="start-btn" onclick="beginExperience()">Enter</div>
    </div>

    <div class="main-container" id="main" style="opacity:0; pointer-events:none;">
        
        <div class="top-bar">
            <div class="title">Soft Power Resonance Grid</div>
            <div class="sub">Hybrid Aura + Heartline Emotional Network</div>
        </div>

        <div class="soft-power-container" id="softField"></div>

        <div class="control-panel">
            <h2>Aura Dynamics</h2>
            <label>Resonance Strength</label>
            <input type="range" min="1" max="10" value="5" id="resSlider">

            <label>Empathy Pulse</label>
            <input type="range" min="1" max="10" value="4" id="pulseSlider">

            <button class="btn" onclick="triggerEmpathyPulse()">Trigger Empathy Pulse</button>
        </div>

        <div class="empathy-meter">
            <strong>Global Soft-Power Charge</strong>
            <div class="meter-bar">
                <div class="meter-fill" id="meterFill"></div>
            </div>
        </div>

        <div class="research-panel">
            <h3>Soft-Power Research Notes</h3>
            ‚Ä¢ Emotional contagion theory  
            ‚Ä¢ Narrative reframing dynamics  
            ‚Ä¢ Feminist peace theory  
            ‚Ä¢ Micro-to-macro compassion propagation  
            ‚Ä¢ Stabilization through perceived safety  
            ‚Ä¢ ‚ÄúAphrodite Effect‚Äù ‚Üí collective calm induction  
        </div>

    </div>

    <script>
        // splash ‚Üí main fade transition
        function beginExperience() {
            const splash = document.getElementById("splash");
            const main = document.getElementById("main");

            splash.style.opacity = 0;
            setTimeout(() => {
                splash.style.display = "none";
                main.style.pointerEvents = "all";
                main.style.animation = "pageFade 2s ease forwards";
            }, 500);
        }

        const field = document.getElementById("softField");
        let nodes = [];
        let lines = [];

        // generate soft-power nodes
        function createNodes(num = 28) {
            for (let i = 0; i < num; i++) {
                const node = document.createElement("div");
                node.classList.add("petal-node");

                const x = Math.random() * (window.innerWidth - 100) + 40;
                const y = Math.random() * (window.innerHeight - 200) + 120;

                node.style.left = x + "px";
                node.style.top = y + "px";

                field.appendChild(node);
                nodes.push({ el: node, x, y });
            }
        }

        // create emotional network lines
        function createHeartlines() {
            for (let i = 0; i < nodes.length; i++) {
                for (let j = i + 1; j < nodes.length; j++) {
                    if (Math.random() < 0.08) {
                        const line = document.createElement("div");
                        line.classList.add("heartline");

                        const n1 = nodes[i];
                        const n2 = nodes[j];

                        const dx = n2.x - n1.x;
                        const dy = n2.y - n1.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);

                        line.style.width = distance + "px";
                        line.style.left = n1.x + "px";
                        line.style.top = n1.y + "px";
                        line.style.transformOrigin = "0 50%";
                        line.style.transform =
                            "rotate(" + Math.atan2(dy, dx) + "rad)";

                        field.appendChild(line);
                        lines.push(line);
                    }
                }
            }
        }

        // empathy pulse animation
        function triggerEmpathyPulse() {
            lines.forEach(line => {
                line.classList.add("active");
                setTimeout(() => line.classList.remove("active"), 850);
            });

            const meter = document.getElementById("meterFill");
            let current = parseInt(meter.style.width);

            let bump = Math.floor(Math.random() * 15) + 10;
            let newWidth = Math.min(current + bump, 100);
            meter.style.width = newWidth + "%";

            const surge = document.createElement("div");
            surge.classList.add("ap-field-surge");
            surge.style.left = (window.innerWidth / 2) + "px";
            surge.style.top = (window.innerHeight / 2) + "px";
            surge.style.animation = "surgePulse 1.6s ease-out forwards";

            field.appendChild(surge);

            setTimeout(() => surge.remove(), 1700);
        }

        // initialize
        createNodes();
        createHeartlines();
    </script>

</body>
</html>
